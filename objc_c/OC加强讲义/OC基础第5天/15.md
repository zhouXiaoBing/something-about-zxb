## 15、【理解】简单的单例模式实现
#### 1、【理解】单例模式概念
* 1、 什么是单例模式:(Singleton)
 * 单例模式的意图是的类的对象成为系统中唯一的实例,提供一个访问点,供客户类共 享资源。

* 2、 什么情况下使用单例?
 * 1）类只能有一个实例,而且必须从一个为人熟知的访问点对其进行访问,比如工厂方 法。
 * 2）这个唯一的实例只能通过子类化进行扩展,而且扩展的对象不会破坏客户端代码。

* 3、 单例设计模式的要点:
 * 1）某个类只能有一个实例。
 * 2）他必须自行创建这个对象
 * 3）必须自行向整个系统提供这个实例;
 * 4）为了保证实例的唯一性,我们必须将如下方法实现进行覆盖
```objc
-(id)copyWithZone:(NSZone *)zone +(id)allocWithZone:(NSZone *)zone -(id)retain -(NSUInteger)retainCount
-(oneway void)release
-(id)autorelease 。
```
 * 5）这个方法必须是一个静态类。
* 4、 在OC中实现单例模式:
```objc
先创建一个单例类,即:
#import <Foundation/Foundation.h>
@interface Bee : NSObject<NSCopying>//注意此处调用了NScoping协议
+(Bee *)shareIsrance;//此处定义了一个工厂方法,用工厂方法来限制实例化过程
分区 第五天(@传智如意大师) 的第 294 页
+(Bee *)shareIsrance;//此处定义了一个工厂方法,用工厂方法来限制实例化过程 (下文中将会提到)
@end //调用NScoping协议,从而在实现文件中覆盖
```

#### 2、简单的单例模式实现

```objc
Tools.h
#import <Foundation/Foundation.h>
@interface Tools : NSObject<NSCopying>
@property (nonatomic,assign) int num;
@property (nonatomic,copy) NSString *text;
+ (instancetype)shareIntances;
@end

Tools.m
#import "Tools.h"
static Tools *instance = nil;
@implementation Tools
+ (instancetype)shareIntances
{
 if (instance==nil) {
    instance = [[self allocWithZone:NULL] init];
}
    return instance;
}
- (id)copyWithZone:(NSZone *)zone
{
   return self;
}
+ (id)allocWithZone:(NSZone *)zone
 {
   @synchronized(self)
    {
       if (instance == nil)
      {
         instance = [super allocWithZone:zone];
         return instance;
      }
   }
  return instance;
}

-(id)retain
{
  return self;
}

-(NSUInteger)retainCount
{
   return NSUIntegerMax;
  }

-(oneway void)release
{
}

-(id)autorelease
{
  return self;
}
@end
```
* 注意:所谓单例,即我们自己创建一个单例类,该类只能生成唯一的对象,即用 if (sharesingleton==nil)方法来保证唯一性,为了防止该对象被复制(copy)或者retain和release等操作,我们必须在所创建的单例的实现文件(.m文件)中将父类的这些方法给覆盖,该目的是为了保证单例模式的一个严谨性。

* `allocWithZone:(NSZone *)zone是在给对象`__sharedGizmoManager__分配内存空间了。其中`zone`可以想象成一个内存池,alloc,allocWithZone或是dealloc这些操作,都是在这个内存池中操作的。cocoa总是会配置一个默认的NSZone,任何默认的内存操作都是在这个“zone”上操作的。默认的NSZone的缺陷在于,它是全局范围的,时间一长,必然会导致内存的碎片化,如果你需要大量的alloc一些object,那么性能就会受到一些影响。所有cocoa提供方法,你可以自己生成一个NSZone(实际上就是我上面的demo那样,重写 allocWithZone方法就行了),并将alloc, copy全部限制在这个”zone“之内。


